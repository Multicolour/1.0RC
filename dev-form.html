<!doctype html>
<html>
  <head>
    <title>Multicolour body parser form</title>
  </head>

  <body>
    <form 
      enctype="multipart/form-data"
      method="POST"
      action="http://localhost:5000">
      <button type="submit">test</button>
      <fieldset>
        <pre>
          <textarea name="json">
            I am some text with multiple 

            line


            breaks

            and stuff \\

            And I do things.
          </textarea>
        </pre>

        <input type="text" value="text field" name="text[]" />
        <input type="text" value="text field" name="text[]" />
        <input type="text" value="text field" name="text[]" />
        <input type="text" value="text field" name="text[]" />
        <input type="text" value="text field" name="text[]" />
        <input type="text" value="text field" name="text[]" />

        <input type="text" value="text field" name="other" />

        <input type="file" name="file" />
        <input type="date" />
      </fieldset>
    </form>

    <pre>
      <code>
      </code>
    </pre>

  <script>
    window.onerror = alert
    window.addEventListener("DOMContentLoaded", function() {
    var json = {
      "json": "field",
      "another": {
        "nested": "ðŸ’¥ðŸ”¥"
      }
    }
document.querySelector("form").addEventListener("submit", function SubmitFileAndJson(event) {
      event.preventDefault()


      var data = new FormData(event.target)

      data.append("json", new Blob([JSON.stringify(json)], {type: "application/json"}))

      fetch(event.target.action, {
        method: "POST",
        body:data
      })
        .then(res => res.json())
        .then(r => document.querySelector("code").innerHTML = (JSON.stringify(r, null, 2)))
    })
    })
  </script>
  </body>
</html>
